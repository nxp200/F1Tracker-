<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formula 1 Stats Tracker</title>
    <style>
        :root {
            --primary-bg: #121212;
            --secondary-bg: #212121;
            --card-bg: #2a2a2a;
            --text-primary: #f5f5f5;
            --text-secondary: #aaaaaa;
            --accent-red: #e10600;
            --accent-hover: #ff1a00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', Arial, sans-serif;
        }
        
        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--accent-red);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 50px;
            margin-right: 10px;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .season-selector {
            background-color: var(--secondary-bg);
            color: var(--text-primary);
            border: 1px solid var(--accent-red);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            outline: none;
        }
        
        .season-selector:hover {
            border-color: var(--accent-hover);
        }
        
        .loading {
            text-align: center;
            margin: 50px 0;
            font-size: 18px;
            color: var(--text-secondary);
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 700;
            color: var(--accent-red);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--accent-red);
            padding-bottom: 10px;
        }
        
        .card-content {
            color: var(--text-secondary);
        }
        
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .standings-table th, .standings-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--secondary-bg);
        }
        
        .standings-table th {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .race-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .race-date {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .highlight {
            color: var(--accent-red);
            font-weight: 600;
        }
        
        .countdown {
            background-color: var(--accent-red);
            color: white;
            border-radius: 4px;
            padding: 10px 15px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
        }
        
        .next-race-card {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            background-image: linear-gradient(to right, rgba(42, 42, 42, 0.9), rgba(42, 42, 42, 0.75));
            background-size: cover;
            padding: 25px;
        }
        
        .next-race-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .next-race-info {
            flex: 2;
        }
        
        .next-race-time {
            flex: 1;
            text-align: right;
        }
        
        .flag {
            width: 24px;
            height: 16px;
            vertical-align: middle;
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .next-race-details {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .next-race-time {
                text-align: left;
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="/api/placeholder/100/50" alt="F1 Logo">
                <h1>Formula 1 Stats Tracker</h1>
            </div>
            <select id="seasonSelector" class="season-selector">
                <option value="2022">2022 Season</option>
                <option value="2023">2023 Season</option>
                <option value="2024">2024 Season</option>
                <option value="2025" selected>2025 Season</option>
            </select>
        </header>
        
        <div id="loading" class="loading">Loading Formula 1 data...</div>
        
        <main id="content" style="display: none;">
            <section class="section">
                <h2 class="section-title">Next Race</h2>
                <div class="card next-race-card" id="nextRace">
                    <!-- Next race content will be inserted here -->
                </div>
            </section>
            
            <section class="section">
                <h2 class="section-title">Driver Standings</h2>
                <div class="card">
                    <h3 class="card-title">Top Drivers</h3>
                    <div class="card-content">
                        <table class="standings-table" id="driverStandings">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Driver</th>
                                    <th>Team</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Driver standings will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section class="section">
                <h2 class="section-title">Constructor Standings</h2>
                <div class="card">
                    <h3 class="card-title">Team Rankings</h3>
                    <div class="card-content">
                        <table class="standings-table" id="constructorStandings">
                            <thead>
                                <tr>
                                    <th>Pos</th>
                                    <th>Team</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Constructor standings will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section class="section">
                <h2 class="section-title">Upcoming Races</h2>
                <div class="grid" id="upcomingRaces">
                    <!-- Upcoming races will be inserted here -->
                </div>
            </section>
            
            <section class="section">
                <h2 class="section-title">Completed Races</h2>
                <div class="grid" id="completedRaces">
                    <!-- Completed races will be inserted here -->
                </div>
            </section>
        </main>
    </div>

    <script>
        // Constants and configuration
        const API_BASE_URL = 'https://v1.formula-1.api-sports.io';
        const API_KEY = 'free_demo_key'; // This is a placeholder - normally would use environment variables
        const DEFAULT_SEASON = '2025';
        
        // DOM Elements
        const seasonSelector = document.getElementById('seasonSelector');
        const loadingElement = document.getElementById('loading');
        const contentElement = document.getElementById('content');
        const nextRaceElement = document.getElementById('nextRace');
        const driverStandingsElement = document.getElementById('driverStandings').querySelector('tbody');
        const constructorStandingsElement = document.getElementById('constructorStandings').querySelector('tbody');
        const upcomingRacesElement = document.getElementById('upcomingRaces');
        const completedRacesElement = document.getElementById('completedRaces');
        
        // Initialize current season
        let currentSeason = seasonSelector.value || DEFAULT_SEASON;
        
        // Cache for API responses
        const cache = {};
        
        // Event listeners
        seasonSelector.addEventListener('change', () => {
            currentSeason = seasonSelector.value;
            loadF1Data(currentSeason);
        });
        
        // Helper function to format dates according to user's locale
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return {
                date: date.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' }),
                time: date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' })
            };
        }
        
        // Helper function to calculate time until next race
        function getTimeUntilRace(raceDate) {
            const now = new Date();
            const race = new Date(raceDate);
            const diff = race - now;
            
            if (diff < 0) return 'Race has started';
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${days}d ${hours}h ${minutes}m`;
        }
        
        // Main API fetch function with error handling and caching
        async function fetchF1Data(endpoint, season) {
            const cacheKey = `${endpoint}_${season}`;
            
            if (cache[cacheKey]) {
                return cache[cacheKey];
            }
            
            try {
                // For demo purposes, we'll use mock data
                // In a real app, you would use:
                // const response = await fetch(`${API_BASE_URL}/${endpoint}?season=${season}`, {
                //    headers: { 'x-apisports-key': API_KEY }
                // });
                
                // This is mock data since we're not actually connecting to an API
                const mockData = getMockData(endpoint, season);
                cache[cacheKey] = mockData;
                return mockData;
            } catch (error) {
                console.error('Error fetching F1 data:', error);
                throw error;
            }
        }
        
        // Create mock data for demonstration
        function getMockData(endpoint, season) {
            // Current date for calculations
            const now = new Date();
            const currentYear = parseInt(season);
            
            switch (endpoint) {
                case 'races':
                    return {
                        response: [
                            {
                                id: 1,
                                name: 'Bahrain Grand Prix',
                                circuit: { name: 'Bahrain International Circuit' },
                                country: { name: 'Bahrain', code: 'BH' },
                                date: `${currentYear}-03-02T13:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-03-02`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 2,
                                name: 'Saudi Arabian Grand Prix',
                                circuit: { name: 'Jeddah Corniche Circuit' },
                                country: { name: 'Saudi Arabia', code: 'SA' },
                                date: `${currentYear}-03-09T16:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-03-09`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 3,
                                name: 'Australian Grand Prix',
                                circuit: { name: 'Albert Park Circuit' },
                                country: { name: 'Australia', code: 'AU' },
                                date: `${currentYear}-03-23T05:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-03-23`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 4,
                                name: 'Japanese Grand Prix',
                                circuit: { name: 'Suzuka Circuit' },
                                country: { name: 'Japan', code: 'JP' },
                                date: `${currentYear}-04-13T06:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-04-13`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 5,
                                name: 'Miami Grand Prix',
                                circuit: { name: 'Miami International Autodrome' },
                                country: { name: 'USA', code: 'US' },
                                date: `${currentYear}-05-05T19:30:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-05-05`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 6,
                                name: 'Monaco Grand Prix',
                                circuit: { name: 'Circuit de Monaco' },
                                country: { name: 'Monaco', code: 'MC' },
                                date: `${currentYear}-05-26T13:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-05-26`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 7,
                                name: 'British Grand Prix',
                                circuit: { name: 'Silverstone Circuit' },
                                country: { name: 'Great Britain', code: 'GB' },
                                date: `${currentYear}-07-07T14:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-07-07`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 8,
                                name: 'Belgian Grand Prix',
                                circuit: { name: 'Circuit de Spa-Francorchamps' },
                                country: { name: 'Belgium', code: 'BE' },
                                date: `${currentYear}-07-28T13:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-07-28`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 9,
                                name: 'Italian Grand Prix',
                                circuit: { name: 'Autodromo Nazionale Monza' },
                                country: { name: 'Italy', code: 'IT' },
                                date: `${currentYear}-09-01T13:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-09-01`) < now) ? 'Completed' : 'Scheduled'
                            },
                            {
                                id: 10,
                                name: 'United States Grand Prix',
                                circuit: { name: 'Circuit of the Americas' },
                                country: { name: 'USA', code: 'US' },
                                date: `${currentYear}-10-20T19:00:00Z`,
                                season: currentYear,
                                type: 'Race',
                                status: currentYear < now.getFullYear() || (currentYear === now.getFullYear() && new Date(`${currentYear}-10-20`) < now) ? 'Completed' : 'Scheduled'
                            },
                        ]
                    };
                
                case 'standings/drivers':
                    return {
                        response: [
                            { position: 1, driver: { name: 'Max Verstappen', abbr: 'VER' }, team: { name: 'Red Bull Racing' }, points: 304 },
                            { position: 2, driver: { name: 'Lando Norris', abbr: 'NOR' }, team: { name: 'McLaren' }, points: 265 },
                            { position: 3, driver: { name: 'Charles Leclerc', abbr: 'LEC' }, team: { name: 'Ferrari' }, points: 250 },
                            { position: 4, driver: { name: 'Lewis Hamilton', abbr: 'HAM' }, team: { name: 'Mercedes' }, points: 235 },
                            { position: 5, driver: { name: 'Oscar Piastri', abbr: 'PIA' }, team: { name: 'McLaren' }, points: 220 },
                            { position: 6, driver: { name: 'Carlos Sainz', abbr: 'SAI' }, team: { name: 'Ferrari' }, points: 205 },
                            { position: 7, driver: { name: 'George Russell', abbr: 'RUS' }, team: { name: 'Mercedes' }, points: 195 },
                            { position: 8, driver: { name: 'Sergio Perez', abbr: 'PER' }, team: { name: 'Red Bull Racing' }, points: 185 },
                            { position: 9, driver: { name: 'Fernando Alonso', abbr: 'ALO' }, team: { name: 'Aston Martin' }, points: 110 },
                            { position: 10, driver: { name: 'Lance Stroll', abbr: 'STR' }, team: { name: 'Aston Martin' }, points: 86 }
                        ]
                    };
                
                case 'standings/teams':
                    return {
                        response: [
                            { position: 1, team: { name: 'Red Bull Racing' }, points: 489 },
                            { position: 2, team: { name: 'McLaren' }, points: 485 },
                            { position: 3, team: { name: 'Ferrari' }, points: 455 },
                            { position: 4, team: { name: 'Mercedes' }, points: 430 },
                            { position: 5, team: { name: 'Aston Martin' }, points: 196 },
                            { position: 6, team: { name: 'Alpine' }, points: 86 },
                            { position: 7, team: { name: 'Williams' }, points: 45 },
                            { position: 8, team: { name: 'RB' }, points: 28 },
                            { position: 9, team: { name: 'Haas F1 Team' }, points: 26 },
                            { position: 10, team: { name: 'Sauber' }, points: 10 }
                        ]
                    };
                
                default:
                    return { response: [] };
            }
        }
        
        // Render F1 data to the DOM
        function renderF1Data(races, drivers, constructors) {
            // Sort races by date
            const sortedRaces = [...races].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Filter upcoming and completed races
            const now = new Date();
            const upcomingRaces = sortedRaces.filter(race => new Date(race.date) > now);
            const completedRaces = sortedRaces.filter(race => new Date(race.date) <= now);
            
            // Render next race
            if (upcomingRaces.length > 0) {
                const nextRace = upcomingRaces[0];
                const { date, time } = formatDateTime(nextRace.date);
                const countdown = getTimeUntilRace(nextRace.date);
                
                nextRaceElement.innerHTML = `
                    <h3 class="card-title">${nextRace.name}</h3>
                    <div class="next-race-details">
                        <div class="next-race-info">
                            <p>
                                <img src="/api/placeholder/24/16" alt="${nextRace.country.name} flag" class="flag">
                                <span class="highlight">${nextRace.circuit.name}</span>, ${nextRace.country.name}
                            </p>
                            <p class="race-date">${date}</p>
                        </div>
                        <div class="next-race-time">
                            <p class="highlight">${time}</p>
                            <div class="countdown">
                                Race starts in: ${countdown}
                            </div>
                        </div>
                    </div>
                `;
            } else {
                nextRaceElement.innerHTML = `
                    <div class="card-content">
                        <p>No upcoming races scheduled for this season.</p>
                    </div>
                `;
            }
            
            // Render driver standings
            driverStandingsElement.innerHTML = drivers.slice(0, 10).map(driver => `
                <tr>
                    <td>${driver.position}</td>
                    <td><strong>${driver.driver.name}</strong></td>
                    <td>${driver.team.name}</td>
                    <td>${driver.points}</td>
                </tr>
            `).join('');
            
            // Render constructor standings
            constructorStandingsElement.innerHTML = constructors.slice(0, 10).map(constructor => `
                <tr>
                    <td>${constructor.position}</td>
                    <td><strong>${constructor.team.name}</strong></td>
                    <td>${constructor.points}</td>
                </tr>
            `).join('');
            
            // Render upcoming races
            upcomingRacesElement.innerHTML = upcomingRaces.slice(1, 5).map(race => {
                const { date, time } = formatDateTime(race.date);
                return `
                    <div class="card">
                        <h3 class="card-title">${race.name}</h3>
                        <div class="card-content">
                            <div class="race-info">
                                <img src="/api/placeholder/24/16" alt="${race.country.name} flag" class="flag">
                                <span>${race.circuit.name}</span>
                            </div>
                            <p class="race-date">${date}</p>
                            <p class="highlight">${time}</p>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (upcomingRaces.length <= 1) {
                upcomingRacesElement.innerHTML = `
                    <div class="card">
                        <div class="card-content">
                            <p>No more races scheduled for this season.</p>
                        </div>
                    </div>
                `;
            }
            
            // Render completed races
            completedRacesElement.innerHTML = completedRaces.slice(-4).map(race => {
                const { date } = formatDateTime(race.date);
                return `
                    <div class="card">
                        <h3 class="card-title">${race.name}</h3>
                        <div class="card-content">
                            <div class="race-info">
                                <img src="/api/placeholder/24/16" alt="${race.country.name} flag" class="flag">
                                <span>${race.circuit.name}</span>
                            </div>
                            <p class="race-date">${date}</p>
                            <p>Status: <span class="highlight">Completed</span></p>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (completedRaces.length === 0) {
                completedRacesElement.innerHTML = `
                    <div class="card">
                        <div class="card-content">
                            <p>No races completed yet for this season.</p>
                        </div>
                    </div>
                `;
            }
            
            // Show content and hide loading
            loadingElement.style.display = 'none';
            contentElement.style.display = 'block';
        }
        
        // Main function to load F1 data
        async function loadF1Data(season) {
            // Show loading, hide content
            loadingElement.style.display = 'block';
            contentElement.style.display = 'none';
            
            try {
                // Fetch all required data
                const [racesData, driversData, constructorsData] = await Promise.all([
                    fetchF1Data('races', season),
                    fetchF1Data('standings/drivers', season),
                    fetchF1Data('standings/teams', season)
                ]);
                
                // Render data to DOM
                renderF1Data(
                    racesData.response,
                    driversData.response,
                    constructorsData.response
                );
            } catch (error) {
                loadingElement.textContent = 'Error loading F1 data. Please try again later.';
                console.error('Error:', error);
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadF1Data(currentSeason);
            
            // Update countdown timer every minute
            setInterval(() => {
                if (upcomingRaces && upcomingRaces.length > 0) {
                    const countdownElement = document.querySelector('.countdown');
                    if (countdownElement) {
                        countdownElement.textContent = `Race starts in: ${getTimeUntilRace(upcomingRaces[0].date)}`;
                    }
                }
            }, 60000);
        });
    </script>
</body>
</html>
