<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Stats Dashboard</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #f5f5f5;
            --accent-color: #e10600;
            --secondary-color: #333333;
        }
        
        body {
            font-family: 'Titillium Web', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            margin: 0;
            font-weight: 700;
            color: var(--text-color);
        }
        
        .logo-image {
            height: 40px;
            margin-right: 10px;
        }
        
        .season-selector {
            background-color: var(--secondary-color);
            color: var(--text-color);
            padding: 8px 16px;
            border: 1px solid var(--accent-color);
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .season-selector:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(225, 6, 0, 0.3);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            margin-top: 0;
            border-bottom: 1px solid var(--accent-color);
            padding-bottom: 10px;
            color: var(--accent-color);
        }
        
        .card h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .loading {
            text-align: center;
            font-style: italic;
            color: #888;
            padding: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        th {
            font-weight: 600;
            color: var(--accent-color);
        }
        
        .next-race {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        
        .countdown {
            font-size: 1.2em;
            font-weight: 600;
            margin: 10px 0;
        }
        
        .race-date {
            font-size: 1.1em;
            margin: 10px 0;
        }
        
        .driver-position {
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            border-radius: 12px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin-right: 10px;
        }
        
        .position-1 {
            background-color: gold;
            color: black;
        }
        
        .position-2 {
            background-color: silver;
            color: black;
        }
        
        .position-3 {
            background-color: #cd7f32;
            color: black;
        }
        
        .team-color {
            display: inline-block;
            width: 4px;
            height: 16px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .error-message {
            color: var(--accent-color);
            text-align: center;
            padding: 20px;
            font-weight: bold;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <svg class="logo-image" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 30" width="120" height="30">
                    <path d="M0 0h30v30H0z" fill="#e10600"/>
                    <path d="M3 3h24v24H3z" fill="#121212"/>
                    <path d="M6 6h18v18H6z" fill="#e10600"/>
                    <path d="M10 10h10v10H10z" fill="#121212"/>
                    <path d="M35 15h10v3H35z" fill="#ffffff"/>
                    <path d="M50 7h3v16h-3z" fill="#ffffff"/>
                    <path d="M50 7h10v3H50z" fill="#ffffff"/>
                    <path d="M50 15h8v3h-8z" fill="#ffffff"/>
                    <path d="M50 20h10v3H50z" fill="#ffffff"/>
                    <path d="M65 7h10v3H65z" fill="#ffffff"/>
                    <path d="M65 7h3v16h-3z" fill="#ffffff"/>
                    <path d="M80 7h13v3H80z" fill="#ffffff"/>
                    <path d="M80 7h3v16h-3z" fill="#ffffff"/>
                    <path d="M80 20h13v3H80z" fill="#ffffff"/>
                    <path d="M100 7h3v16h-3z" fill="#ffffff"/>
                    <path d="M108 7h3v16h-3z" fill="#ffffff"/>
                    <path d="M100 7h11v3h-11z" fill="#ffffff"/>
                    <path d="M100 20h11v3h-11z" fill="#ffffff"/>
                </svg>
                <h1>F1 Stats Dashboard</h1>
            </div>
            <select id="seasonSelector" class="season-selector">
                <option value="2022">2022 Season</option>
                <option value="2023">2023 Season</option>
                <option value="2024">2024 Season</option>
                <option value="2025" selected>2025 Season</option>
            </select>
        </header>
        
        <div class="grid">
            <div class="card">
                <h2>Driver Standings</h2>
                <div id="driverStandings" class="loading">Loading driver standings...</div>
            </div>
            
            <div class="card">
                <h2>Constructor Standings</h2>
                <div id="constructorStandings" class="loading">Loading constructor standings...</div>
            </div>
            
            <div class="card">
                <h2>Next Race</h2>
                <div id="nextRace" class="loading">Loading next race information...</div>
            </div>
            
            <div class="card">
                <h2>Season Calendar</h2>
                <div id="raceSchedule" class="loading">Loading race schedule...</div>
            </div>
        </div>
    </div>

    <script>
        // Team colors mapping
        const teamColors = {
            'Mercedes': '#00D2BE',
            'Red Bull': '#0600EF',
            'Ferrari': '#DC0000',
            'McLaren': '#FF8700',
            'Alpine': '#0090FF',
            'AlphaTauri': '#2B4562',
            'Aston Martin': '#006F62',
            'Williams': '#005AFF',
            'Alfa Romeo': '#900000',
            'Haas F1 Team': '#FFFFFF',
            'Racing Point': '#F596C8',
            'Renault': '#FFF500',
            'Toro Rosso': '#469BFF',
            'Sauber': '#9B0000',
            'Force India': '#FF80C7',
            'Lotus F1': '#FFB800',
            'Marussia': '#6E0000',
            'Caterham': '#00FF00',
            'RB': '#6692FF',
            'Visa Cash App RB': '#6692FF',
            'Kick Sauber': '#52E252',
            'Sauber': '#52E252',
            'RB F1 Team': '#6692FF',
            'Alpine F1 Team': '#0090FF',
        };
        
        // Default constructor if not found in mapping
        const defaultTeamColor = '#CCCCCC';
        
        // Global variables
        let selectedSeason = '2025';
        let countdownInterval;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set up season selector change event
            const seasonSelector = document.getElementById('seasonSelector');
            seasonSelector.addEventListener('change', (e) => {
                selectedSeason = e.target.value;
                loadAllData();
            });
            
            // Initial data load
            loadAllData();
        });
        
        // Function to load all data
        function loadAllData() {
            clearInterval(countdownInterval); // Clear any existing countdown timer
            loadDriverStandings();
            loadConstructorStandings();
            loadNextRace();
            loadRaceSchedule();
        }
        
        // Function to fetch data from API
        async function fetchF1Data(endpoint) {
            try {
                // Using the Formula 1 API
                const response = await fetch(`https://ergast.com/api/f1/${selectedSeason}/${endpoint}.json`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }
        
        // Load driver standings
        async function loadDriverStandings() {
            const container = document.getElementById('driverStandings');
            container.innerHTML = '<div class="loading">Loading driver standings...</div>';
            
            try {
                const data = await fetchF1Data('driverStandings');
                
                if (!data || !data.MRData || !data.MRData.StandingsTable || !data.MRData.StandingsTable.StandingsLists || data.MRData.StandingsTable.StandingsLists.length === 0) {
                    container.innerHTML = `<div class="error-message">Driver standings not available for ${selectedSeason} season.</div>`;
                    return;
                }
                
                const standings = data.MRData.StandingsTable.StandingsLists[0].DriverStandings;
                
                let html = `
                    <table>
                        <tr>
                            <th>Pos</th>
                            <th>Driver</th>
                            <th>Team</th>
                            <th>Points</th>
                        </tr>
                `;
                
                standings.forEach(driver => {
                    const teamName = driver.Constructors[0].name;
                    const teamColor = teamColors[teamName] || defaultTeamColor;
                    
                    const positionClass = driver.position <= 3 ? `position-${driver.position}` : '';
                    
                    html += `
                        <tr>
                            <td><div class="driver-position ${positionClass}">${driver.position}</div></td>
                            <td>${driver.Driver.givenName} ${driver.Driver.familyName}</td>
                            <td><span class="team-color" style="background-color: ${teamColor};"></span>${teamName}</td>
                            <td>${driver.points}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading driver standings:', error);
                container.innerHTML = '<div class="error-message">Failed to load driver standings</div>';
            }
        }
        
        // Load constructor standings
        async function loadConstructorStandings() {
            const container = document.getElementById('constructorStandings');
            container.innerHTML = '<div class="loading">Loading constructor standings...</div>';
            
            try {
                const data = await fetchF1Data('constructorStandings');
                
                if (!data || !data.MRData || !data.MRData.StandingsTable || !data.MRData.StandingsTable.StandingsLists || data.MRData.StandingsTable.StandingsLists.length === 0) {
                    container.innerHTML = `<div class="error-message">Constructor standings not available for ${selectedSeason} season.</div>`;
                    return;
                }
                
                const standings = data.MRData.StandingsTable.StandingsLists[0].ConstructorStandings;
                
                let html = `
                    <table>
                        <tr>
                            <th>Pos</th>
                            <th>Team</th>
                            <th>Points</th>
                        </tr>
                `;
                
                standings.forEach(constructor => {
                    const teamName = constructor.Constructor.name;
                    const teamColor = teamColors[teamName] || defaultTeamColor;
                    
                    const positionClass = constructor.position <= 3 ? `position-${constructor.position}` : '';
                    
                    html += `
                        <tr>
                            <td><div class="driver-position ${positionClass}">${constructor.position}</div></td>
                            <td><span class="team-color" style="background-color: ${teamColor};"></span>${teamName}</td>
                            <td>${constructor.points}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading constructor standings:', error);
                container.innerHTML = '<div class="error-message">Failed to load constructor standings</div>';
            }
        }
        
        // Load next race information
        async function loadNextRace() {
            const container = document.getElementById('nextRace');
            container.innerHTML = '<div class="loading">Loading next race information...</div>';
            
            try {
                const data = await fetchF1Data('');
                
                if (!data || !data.MRData || !data.MRData.RaceTable || !data.MRData.RaceTable.Races || data.MRData.RaceTable.Races.length === 0) {
                    container.innerHTML = `<div class="error-message">Race schedule not available for ${selectedSeason} season.</div>`;
                    return;
                }
                
                const races = data.MRData.RaceTable.Races;
                const today = new Date();
                
                // Find the next race (first race in the future)
                let nextRace = null;
                for (const race of races) {
                    const raceDate = new Date(`${race.date}T${race.time || '00:00:00Z'}`);
                    if (raceDate > today) {
                        nextRace = race;
                        break;
                    }
                }
                
                if (!nextRace) {
                    // If no future race is found, take the last race of the season
                    container.innerHTML = '<div class="next-race">No upcoming races for this season</div>';
                    return;
                }
                
                // Parse race date and time
                const raceDateTime = new Date(`${nextRace.date}T${nextRace.time || '00:00:00Z'}`);
                
                // Format the date and time in the user's locale
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const timeOptions = { hour: '2-digit', minute: '2-digit', timeZoneName: 'short' };
                
                const localDate = raceDateTime.toLocaleDateString(undefined, dateOptions);
                const localTime = raceDateTime.toLocaleTimeString(undefined, timeOptions);
                
                let html = `
                    <div class="next-race">
                        <h3>${nextRace.raceName}</h3>
                        <p>${nextRace.Circuit.circuitName}, ${nextRace.Circuit.Location.locality}, ${nextRace.Circuit.Location.country}</p>
                        <p class="race-date">Race Date: ${localDate}</p>
                        <p class="race-date">Race Time: ${localTime}</p>
                        <div id="countdown" class="countdown"></div>
                    </div>
                `;
                
                container.innerHTML = html;
                
                // Set up countdown timer
                startCountdown(raceDateTime);
                
            } catch (error) {
                console.error('Error loading next race:', error);
                container.innerHTML = '<div class="error-message">Failed to load next race information</div>';
            }
        }
        
        // Countdown timer function
        function startCountdown(raceDate) {
            const countdownElement = document.getElementById('countdown');
            
            // Update countdown every second
            countdownInterval = setInterval(() => {
                const now = new Date();
                const timeDiff = raceDate - now;
                
                // If race is in the past, stop countdown
                if (timeDiff <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.innerHTML = 'Race has started!';
                    return;
                }
                
                // Calculate days, hours, minutes, and seconds
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                
                countdownElement.innerHTML = `Race starts in: ${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }
        
        // Load full race schedule
        async function loadRaceSchedule() {
            const container = document.getElementById('raceSchedule');
            container.innerHTML = '<div class="loading">Loading race schedule...</div>';
            
            try {
                const data = await fetchF1Data('');
                
                if (!data || !data.MRData || !data.MRData.RaceTable || !data.MRData.RaceTable.Races || data.MRData.RaceTable.Races.length === 0) {
                    container.innerHTML = `<div class="error-message">Race schedule not available for ${selectedSeason} season.</div>`;
                    return;
                }
                
                const races = data.MRData.RaceTable.Races;
                const today = new Date();
                
                let html = `
                    <table>
                        <tr>
                            <th>Round</th>
                            <th>Grand Prix</th>
                            <th>Circuit</th>
                            <th>Date</th>
                        </tr>
                `;
                
                races.forEach(race => {
                    const raceDate = new Date(`${race.date}T${race.time || '00:00:00Z'}`);
                    const isPast = raceDate < today;
                    
                    // Format date to local date
                    const formattedDate = raceDate.toLocaleDateString(undefined, { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    
                    html += `
                        <tr style="${isPast ? 'opacity: 0.7;' : ''}">
                            <td>${race.round}</td>
                            <td>${race.raceName}</td>
                            <td>${race.Circuit.circuitName}</td>
                            <td>${formattedDate}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading race schedule:', error);
                container.innerHTML = '<div class="error-message">Failed to load race schedule</div>';
            }
        }
    </script>
</body>
</html>
